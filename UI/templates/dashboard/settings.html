<div class="card">
    <div class="card-header">
        <h5 class="mb-0">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h5>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <h6>üé® –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ</h6>
                <div class="mb-3">
                    <label class="form-label">–¢–µ–º–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è</label>
                    <div class="btn-group w-100" role="group">
                        <input type="radio" class="btn-check" name="themeOption" id="themeLight" value="light" autocomplete="off">
                        <label class="btn btn-outline-primary" for="themeLight">‚òÄÔ∏è –°–≤–µ—Ç–ª–∞—è</label>
                        
                        <input type="radio" class="btn-check" name="themeOption" id="themeDark" value="dark" autocomplete="off">
                        <label class="btn btn-outline-primary" for="themeDark">üåô –¢—ë–º–Ω–∞—è</label>
                    </div>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">–†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞</label>
                    <select class="form-select" id="fontSizeSelect">
                        <option value="small">–ú–∞–ª–µ–Ω—å–∫–∏–π</option>
                        <option value="medium">–°—Ä–µ–¥–Ω–∏–π</option>
                        <option value="large">–ë–æ–ª—å—à–æ–π</option>
                    </select>
                </div>
            </div>
            
            <div class="col-md-6">
                <h6>üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h6>
                <div class="form-check form-switch mb-3">
                    <input class="form-check-input" type="checkbox" id="notificationsEnabled" checked>
                    <label class="form-check-label" for="notificationsEnabled">
                        –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
                    </label>
                </div>
                
                <div class="form-check form-switch mb-3">
                    <input class="form-check-input" type="checkbox" id="soundEnabled" checked>
                    <label class="form-check-label" for="soundEnabled">
                        –ó–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã
                    </label>
                </div>
            </div>
        </div>
        
        <hr>
        
        <div class="d-flex justify-content-between">
            <button type="button" class="btn btn-outline-secondary" onclick="resetSettings()">
                üîÑ –°–±—Ä–æ—Å–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            </button>
            <button type="button" class="btn btn-primary" onclick="saveSettings()">
                üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
            </button>
        </div>
    </div>
</div>

<script>
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
function initSettings() {
    loadSettings();
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
async function loadSettings() {
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑ localStorage
    const theme = localStorage.getItem('theme') || 'light';
    const fontSize = localStorage.getItem('fontSize') || 'medium';
    const notificationsEnabled = localStorage.getItem('notificationsEnabled') !== 'false';
    const soundEnabled = localStorage.getItem('soundEnabled') !== 'false';
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è
    document.querySelector(`input[name="themeOption"][value="${theme}"]`).checked = true;
    document.getElementById('fontSizeSelect').value = fontSize;
    document.getElementById('notificationsEnabled').checked = notificationsEnabled;
    document.getElementById('soundEnabled').checked = soundEnabled;
    
    // –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å —Å–µ—Ä–≤–µ—Ä–∞
    try {
        const response = await fetch('/api/settings');
        const data = await response.json();
        
        if (data.settings) {
            document.querySelector(`input[name="themeOption"][value="${data.settings.theme}"]`).checked = true;
            document.getElementById('fontSizeSelect').value = data.settings.font_size;
            document.getElementById('notificationsEnabled').checked = data.settings.notifications_enabled;
            document.getElementById('soundEnabled').checked = data.settings.sound_enabled;
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º—É
            ThemeManager.setTheme(data.settings.theme);
        }
    } catch (e) {
        console.log('–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫');
    }
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
async function saveSettings() {
    const theme = document.querySelector('input[name="themeOption"]:checked').value;
    const fontSize = document.getElementById('fontSizeSelect').value;
    const notificationsEnabled = document.getElementById('notificationsEnabled').checked;
    const soundEnabled = document.getElementById('soundEnabled').checked;
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
    localStorage.setItem('theme', theme);
    localStorage.setItem('fontSize', fontSize);
    localStorage.setItem('notificationsEnabled', notificationsEnabled);
    localStorage.setItem('soundEnabled', soundEnabled);
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–º—É
    ThemeManager.setTheme(theme);
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞
    applyFontSize(fontSize);
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
    try {
        const response = await fetch('/api/settings', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                theme,
                font_size: fontSize,
                notifications_enabled: notificationsEnabled,
                sound_enabled: soundEnabled
            })
        });
        
        const data = await response.json();
        if (data.success) {
            showToast('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', 'success');
        }
    } catch (e) {
        showToast('‚ö†Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ', 'warning');
    }
}

// –°–±—Ä–æ—Å –Ω–∞—Å—Ç—Ä–æ–µ–∫
async function resetSettings() {
    if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏?')) {
        return;
    }
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
    localStorage.removeItem('theme');
    localStorage.removeItem('fontSize');
    localStorage.removeItem('notificationsEnabled');
    localStorage.removeItem('soundEnabled');
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    document.querySelector('input[name="themeOption"][value="light"]').checked = true;
    document.getElementById('fontSizeSelect').value = 'medium';
    document.getElementById('notificationsEnabled').checked = true;
    document.getElementById('soundEnabled').checked = true;
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º
    ThemeManager.setTheme('light');
    applyFontSize('medium');
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
    try {
        await fetch('/api/settings/reset', { method: 'POST' });
        showToast('üîÑ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–±—Ä–æ—à–µ–Ω—ã', 'info');
    } catch (e) {
        showToast('üîÑ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–±—Ä–æ—à–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ', 'info');
    }
}

// –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —à—Ä–∏—Ñ—Ç–∞
function applyFontSize(size) {
    const sizes = {
        'small': '14px',
        'medium': '16px',
        'large': '18px'
    };
    document.body.style.fontSize = sizes[size] || '16px';
}

// Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
function showToast(message, type = 'info') {
    const toast = document.createElement('div');
    toast.className = `alert alert-${type} position-fixed top-0 end-0 m-3`;
    toast.style.zIndex = '9999';
    toast.innerHTML = message;
    document.body.appendChild(toast);
    
    setTimeout(() => toast.remove(), 3000);
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ç–µ–º—ã
document.querySelectorAll('input[name="themeOption"]').forEach(radio => {
    radio.addEventListener('change', function() {
        ThemeManager.setTheme(this.value);
    });
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ —à—Ä–∏—Ñ—Ç–∞
document.getElementById('fontSizeSelect')?.addEventListener('change', function() {
    applyFontSize(this.value);
});

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
document.addEventListener('DOMContentLoaded', initSettings);
</script>
