=============================================
AI-ГЕНЕРАЦИЯ ЗАДАНИЙ - РУКОВОДСТВО
=============================================

ОБЗОР
-----
Система генерации заданий использует гибридный подход:
- DLL генераторы (C++) для математических задач
- AI генераторы (LLM) для всех остальных предметов

АРХИТЕКТУРА
-----------

1. GeneratorManager (generator_manager.py)
   - Главный класс-диспетчер
   - Выбирает генератор на основе конфигурации
   - Обеспечивает fallback механизм

2. Конфигурация (config.py)
   - Определяет тип генератора для каждой темы
   - Маппинг тем на методы DLL
   - Настройки по умолчанию

3. LLM интеграция (bot/chat.py)
   - Использует модель deepseek-r1:7b через Ollama
   - Температура: 0.0 (детерминированность)
   - Локальный запуск без внешних API

ПОДДЕРЖИВАЕМЫЕ ТИПЫ ГЕНЕРАТОРОВ
--------------------------------

GeneratorType.DLL - Быстрый C++ генератор
  Поддерживаемые темы:
  - Линейные уравнения
  - Квадратные уравнения
  - Показательные уравнения
  - Линейные неравенства
  - Квадратные неравенства

GeneratorType.AI - AI генератор (по умолчанию)
  Используется для:
  - Геометрия (все темы)
  - Физика (все темы)
  - Химия (все темы)
  - Биология (все темы)
  - География (все темы)
  - История (все темы)
  - Обществознание (все темы)
  - Русский язык (все темы)
  - Английский язык (все темы)
  - Информатика (все темы)
  - Алгебра (функции, прогрессии, некоторые уравнения)

ИСПОЛЬЗОВАНИЕ
-------------

Базовый пример:

    from testing.generator_manager import generator_manager
    
    # Генерация теста с вариантами ответов
    test = generator_manager.generate_test(
        subject="Физика",
        section="Механика",
        topic="Кинематика",
        difficulty=2,          # 1=легкий, 2=средний, 3=сложный
        num_questions=5,       # количество вопросов
        with_options=True      # с вариантами ответов
    )
    
    # Результат
    {
        "questions": [
            {
                "question": "Текст вопроса",
                "options": ["A", "B", "C", "D"],
                "correct_answer": "A"
            }
        ],
        "generator": "AI",
        "test_type": "with_options"
    }

ПАРАМЕТРЫ ГЕНЕРАЦИИ
-------------------

difficulty (int): Уровень сложности
  1 - Лёгкий: базовые вопросы
  2 - Средний: стандартный уровень
  3 - Сложный: продвинутый уровень

num_questions (int): Количество вопросов
  Минимум: 3
  Максимум: 20
  По умолчанию: 5

with_options (bool): Варианты ответов
  True: Тест с 4 вариантами ответов
  False: Тест с открытым ответом

FALLBACK МЕХАНИЗМ
-----------------

Если основной генератор не работает, система автоматически
переключается на следующий в цепочке:

  DLL → AI → LOCAL

1. DLL генератор пытается создать задачи
2. Если не удалось - переключается на AI
3. Если AI не работает - использует локальную базу заданий

КОНТЕКСТНАЯ АДАПТАЦИЯ AI
-------------------------

AI автоматически адаптирует стиль вопросов под предмет:

- Алгебра: математические задачи с числами и формулами
- Геометрия: задачи с фигурами, углами и расстояниями
- Физика: физические задачи с формулами и вычислениями
- Химия: вопросы с реакциями, элементами и веществами
- Биология: вопросы о живых организмах и процессах
- И т.д.

ВАЛИДАЦИЯ РЕЗУЛЬТАТОВ
---------------------

AI-генерация включает автоматическую валидацию:

✓ Проверка JSON структуры
✓ Наличие обязательных полей (question, correct_answer)
✓ Для тестов с вариантами: наличие массива options
✓ Очистка от служебных тегов (<think>, <reasoning>)
✓ Удаление markdown форматирования

ТЕСТИРОВАНИЕ
------------

Запустите тестовый скрипт для проверки работы:

    python test_ai_generation.py

Скрипт проверит генерацию для всех типов предметов
и выведет подробный отчёт о результатах.

ТРЕБОВАНИЯ
----------

Системные:
- Python 3.8+
- Ollama с моделью deepseek-r1:7b

Python пакеты:
- langchain-ollama
- flask
- sqlalchemy

Для установки зависимостей:

    pip install -r info/requirements.txt

ДОБАВЛЕНИЕ НОВЫХ ТЕМ
--------------------

Чтобы добавить поддержку новой темы:

1. Откройте testing/config.py

2. Найдите нужный предмет в словаре GENERATORS

3. Добавьте тему с типом генератора:

    "Новая тема": GeneratorType.AI

4. Если есть DLL метод, добавьте в DLL_METHOD_MAPPING:

    "Новая тема": "dll_method_name"

РЕШЕНИЕ ПРОБЛЕМ
---------------

Проблема: AI не генерирует вопросы
Решение: Проверьте, что Ollama запущен и модель загружена:
  ollama run deepseek-r1:7b

Проблема: Вопросы низкого качества
Решение: Увеличьте сложность (difficulty=3) или измените
  контекст в _generate_ai_test()

Проблема: JSON ошибки парсинга
Решение: AI иногда добавляет лишний текст. Система
  автоматически очищает ответ, но можно улучшить промпт.

Проблема: DLL генератор не работает
Решение: Проверьте наличие algebra.dll в папке generator/
  и правильность компиляции библиотеки.

ЛОГИРОВАНИЕ
-----------

Система выводит подробные логи генерации:

- "Генерация теста: [предмет]/[раздел]/[тема]"
- "Генератор: [тип]"
- "AI сгенерировал [N] валидных вопросов"
- Ошибки с подробным описанием

ПРОИЗВОДИТЕЛЬНОСТЬ
------------------

DLL генератор:
  ~ 0.1-1 мс на вопрос
  Идеально для математики

AI генератор:
  ~ 2-10 секунд на тест из 5 вопросов
  Зависит от мощности системы и модели

LOCAL генератор:
  < 1 мс на тест
  Fallback с предопределёнными вопросами

БЕЗОПАСНОСТЬ
------------

✓ Локальное выполнение (без отправки данных в интернет)
✓ Детерминированная генерация (temperature=0.0)
✓ Валидация всех входных данных
✓ Ограничение количества вопросов (max=20)
✓ Очистка от потенциально опасного контента

ЛИЦЕНЗИЯ
--------

Внутренний модуль проекта WebVA.
Не предназначен для распространения.

=============================================

