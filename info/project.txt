Этапы разработки Web-Virtual Assistant


1. Установка зависимостей

Для работы проекта были установлены библиотеки Python: Flask для
создания веб-сервера, SQLAlchemy для работы с базой данных, LangChain
для интеграции с искусственным интеллектом, cffi для вызова функций
из кода, написанного на C++.

Файл requirements.txt:
    sqlalchemy
    flask
    langchain-ollama
    cffi
    openai


2. Создание структуры проекта

Проект был разделён на отдельные модули для удобства разработки
и поддержки кода. Каждый модуль отвечает за свою часть функционала:
UI — веб-интерфейс, database — работа с данными, bot — чат-бот,
formulas — математические вычисления, data_processor — валидация.


3. Разработка базы данных

Были созданы модели для хранения данных. Пример модели пользователя:

    class User(Base):
        __tablename__ = 'users'
        
        id = Column(Integer, primary_key=True, autoincrement=True)
        email = Column(String(255), unique=True, nullable=False)
        password_hash = Column(String(255), nullable=False)
        first_name = Column(String(100), nullable=False)
        last_name = Column(String(100), nullable=False)
        role = Column(String(10), nullable=False)
        city = Column(String(100))
        school = Column(String(255))
        is_online = Column(Boolean, default=False)
        created_at = Column(DateTime, default=datetime.utcnow)


4. Создание веб-страниц

Разработаны HTML-шаблоны для страниц авторизации и личного
кабинета пользователя с использованием шаблонизатора Jinja2.


5. Написание серверной логики

Реализованы обработчики запросов. Пример обработчика авторизации:

    @app.route('/login', methods=['GET', 'POST'])
    def login():
        if request.method == 'POST':
            email = request.form.get('email', '').strip()
            password = request.form.get('password', '')
            
            success, user_data = db.authenticate_user(email, password)
            if success:
                auth_manager.login_user(user_data)
                return redirect(url_for('dashboard'))
            else:
                flash('Неверный email или пароль', 'error')
        
        return render_template('login.html')


6. Реализация работы с базой данных

Написан класс Database для выполнения всех операций с данными.
Пример метода хеширования пароля:

    def hash_password(self, password):
        return hashlib.sha256(password.encode("utf-8")).hexdigest()


7. Интеграция чат-бота

Создан класс для работы с языковыми моделями. Пример структуры промпта:

    class Prompt:
        def __init__(self, role: str = "", task: str = "", answer: str = ""):
            self.__prompt_template = "role: {role}\ntask: {task}\nanswer: {answer}"
        
        def prompt(self) -> str:
            return self.__prompt_template.format(
                role=self.__role,
                task=self.__task,
                answer=self.__answer
            )


8. Разработка модуля формул

Для вычислений написаны функции на Python. Пример класса физических формул:

    class Force:
        @staticmethod
        def gravity(m: float, g: float = 9.80665) -> float:
            """Сила тяжести: F = m * g"""
            return m * g
        
        @staticmethod
        def newton_second_law(m: float, a: float) -> float:
            """Второй закон Ньютона: F = m * a"""
            return m * a
        
        @staticmethod
        def friction(u: float, N: float) -> float:
            """Сила трения: F = μ * N"""
            return u * N


9. Система авторизации

Реализован класс AuthManager для управления сессиями пользователей:

    class AuthManager:
        @staticmethod
        def is_logged_in():
            session = AuthManager._get_session()
            return session.get('logged_in', False)
        
        @staticmethod
        def login_user(user_data):
            db.update_user_online_status(user_data['id'], True)
            session['logged_in'] = True
            session['user_data'] = user_data


10. Валидация данных

Добавлена проверка корректности вводимых данных. Пример валидации email:

    @staticmethod
    def validate_email(email):
        if not email:
            return InputError("Email не может быть пустым")
        
        email_pattern = r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'
        if not re.match(email_pattern, email):
            return InputError("Неверный формат email")
        
        return InputSuccess("OK")


11. Оформление интерфейса

Написаны CSS-стили с поддержкой светлой и тёмной темы.
Стили подключаются через Flask из папки static/css.


12. Клиентские скрипты

Созданы JavaScript-файлы для динамического обновления страниц
без перезагрузки с использованием AJAX-запросов к API серверу.


13. Запуск приложения

Настроен запуск веб-сервиса. Пример запуска сервера:

    if __name__ == '__main__':
        app.run(host='0.0.0.0', port=5000, debug=True)


14. Конфигурация

Настроены параметры для корректной работы приложения через
переменные окружения и файлы настроек в каждом модуле.
